# winxclubsup_bot — master_v3

Финальная версия для деплоя через **GitHub → Railway**.

## Возможности
- Две темы: **инфо** (ник/класс/БМ/профиль/топбм/нет) и **аукцион** (аук/очередь)
- Привязка доступна **только** лидеру и офицерам (админов группы исключили)
- Интерактивный выбор **класса** (кнопки + Готово/Назад)
- Интерактивный **аукцион**: множественный выбор предметов + Подтвердить/Назад, автоскрытие клавиатуры
- `/help_master` — список всех команд для игроков
- Google Sheets: без автосоздания новых колонок в «Аукцион»

## Быстрый старт (Railway)
1. Создай репозиторий **winxclubsup_bot** на GitHub и залей файлы из этого архива.
2. Railway → **New Project → Deploy from GitHub Repo** → привяжи репозиторий.
3. В **Variables** добавь:
   - `BOT_TOKEN` — токен бота из BotFather
   - `GSHEET_ID` — ID таблицы (`12VXDjIS_crjN1b_c1w2_tk5HnfhXfejFWJQBiCZ3klc`)
   - `LEADER_ID` — `@yakovlef`
   - `GOOGLE_CREDENTIALS` — JSON сервисного аккаунта в 1 строку (см. ниже)
   - `STARTUP_ANNOUNCE` — `1`
4. Deploy. Procfile запускает воркер: `worker: python main.py`.

### Где взять GOOGLE_CREDENTIALS
Скачай JSON ключ сервисного аккаунта в Google Cloud → Service Accounts → Keys.  
Преобразуй в одну строку (macOS):
```bash
brew install jq   # если нет jq
jq -c . service_account.json
```
Скопируй результат целиком в переменную `GOOGLE_CREDENTIALS` (внутри будут `\n`).

## Привязка к темам
Добавь бота в группу с темами (форумы), затем:
- В теме для персонажей: `/привязать_инфо`
- В теме для аукциона: `/привязать_аук`
- Сбросить привязки: `/отвязать_все`

Команды привязки доступны только лидеру и офицерам.

## Команды
Игроки:
- `/ник <имя>` — регистрация/смена ника
- `/класс` — выбор класса кнопками (Готово/Назад)
- `/бм <число>` — обновить БМ (с историей)
- `/профиль` — показать профиль
- `/топбм` — топ-5 прироста БМ за 7 дней
- `/нет <дд.мм> <причина>` — отметить отсутствие
- `/аук` — выбор предметов аукциона кнопками (множественный выбор + Подтвердить/Назад)
- `/очередь <предмет>` — показать очередь по предмету
- `/help_master` — список всех команд

Лидер/офицеры:
- `/привязать_инфо`, `/привязать_аук`, `/отвязать_все`

## Примечания
- Меню команд Telegram регистрируется **только для групп** (латиницей, чтобы избежать Bot_command_invalid).
- После старта (если задать `STARTUP_ANNOUNCE=1`) бот отправит сообщение в привязанные темы.
